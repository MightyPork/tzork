var tz_aliases = {
    "Afghanistan": "Asia/Kabul",
    "Aland Islands": "Europe/Mariehamn",
    "Albania": "Europe/Tirane",
    "Algeria": "Africa/Algiers",
    "American Samoa": "Pacific/Pago_Pago",
    "Andorra": "Europe/Andorra",
    "Angola": "Africa/Luanda",
    "Anguilla": "America/Anguilla",
    "Antigua and Barbuda": "America/Antigua",
    "Armenia": "Asia/Yerevan",
    "Aruba": "America/Aruba",
    "Austria": "Europe/Vienna",
    "Azerbaijan": "Asia/Baku",
    "Bahamas": "America/Nassau",
    "Bahrain": "Asia/Bahrain",
    "Bangladesh": "Asia/Dhaka",
    "Barbados": "America/Barbados",
    "Belarus": "Europe/Minsk",
    "Belgium": "Europe/Brussels",
    "Belize": "America/Belize",
    "Benin": "Africa/Porto-Novo",
    "Bermuda": "Atlantic/Bermuda",
    "Bhutan": "Asia/Thimphu",
    "Bolivia": "America/La_Paz",
    "Bonaire, Saint Eustatius and Saba": "America/Kralendijk",
    "Bosnia and Herzegovina": "Europe/Sarajevo",
    "Botswana": "Africa/Gaborone",
    "British Indian Ocean Territory": "Indian/Chagos",
    "British Virgin Islands": "America/Tortola",
    "Brunei": "Asia/Brunei",
    "Bulgaria": "Europe/Sofia",
    "Burkina Faso": "Africa/Ouagadougou",
    "Burundi": "Africa/Bujumbura",
    "Cambodia": "Asia/Phnom_Penh",
    "Cameroon": "Africa/Douala",
    "Cape Verde": "Atlantic/Cape_Verde",
    "Cayman Islands": "America/Cayman",
    "Central African Republic": "Africa/Bangui",
    "Chad": "Africa/Ndjamena",
    "Christmas Island": "Indian/Christmas",
    "Cocos Islands": "Indian/Cocos",
    "Colombia": "America/Bogota",
    "Comoros": "Indian/Comoro",
    "Cook Islands": "Pacific/Rarotonga",
    "Costa Rica": "America/Costa_Rica",
    "Croatia": "Europe/Zagreb",
    "Cuba": "America/Havana",
    "Curaçao": "America/Curacao",
    "Cyprus": "Asia/Nicosia",
    "Czech Republic": "Europe/Prague",
    "Denmark": "Europe/Copenhagen",
    "Djibouti": "Africa/Djibouti",
    "Dominica": "America/Dominica",
    "Dominican Republic": "America/Santo_Domingo",
    "East Timor": "Asia/Dili",
    "Egypt": "Africa/Cairo",
    "El Salvador": "America/El_Salvador",
    "Equatorial Guinea": "Africa/Malabo",
    "Eritrea": "Africa/Asmara",
    "Estonia": "Europe/Tallinn",
    "Ethiopia": "Africa/Addis_Ababa",
    "Falkland Islands": "Atlantic/Stanley",
    "Faroe Islands": "Atlantic/Faroe",
    "Fiji": "Pacific/Fiji",
    "Finland": "Europe/Helsinki",
    "France": "Europe/Paris",
    "French Guiana": "America/Cayenne",
    "French Southern Territories": "Indian/Kerguelen",
    "Gabon": "Africa/Libreville",
    "Gambia": "Africa/Banjul",
    "Georgia": "Asia/Tbilisi",
    "Ghana": "Africa/Accra",
    "Gibraltar": "Europe/Gibraltar",
    "Greece": "Europe/Athens",
    "Grenada": "America/Grenada",
    "Guadeloupe": "America/Guadeloupe",
    "Guam": "Pacific/Guam",
    "Guatemala": "America/Guatemala",
    "Guernsey": "Europe/Guernsey",
    "Guinea": "Africa/Conakry",
    "Guinea-Bissau": "Africa/Bissau",
    "Guyana": "America/Guyana",
    "Haiti": "America/Port-au-Prince",
    "Honduras": "America/Tegucigalpa",
    "Hong Kong": "Asia/Hong_Kong",
    "Hungary": "Europe/Budapest",
    "Iceland": "Atlantic/Reykjavik",
    "India": "Asia/Kolkata",
    "Iran": "Asia/Tehran",
    "Iraq": "Asia/Baghdad",
    "Ireland": "Europe/Dublin",
    "Isle of Man": "Europe/Isle_of_Man",
    "Israel": "Asia/Jerusalem",
    "Italy": "Europe/Rome",
    "Ivory Coast": "Africa/Abidjan",
    "Jamaica": "America/Jamaica",
    "Japan": "Asia/Tokyo",
    "Jersey": "Europe/Jersey",
    "Jordan": "Asia/Amman",
    "Kenya": "Africa/Nairobi",
    "Kuwait": "Asia/Kuwait",
    "Kyrgyzstan": "Asia/Bishkek",
    "Laos": "Asia/Vientiane",
    "Latvia": "Europe/Riga",
    "Lebanon": "Asia/Beirut",
    "Lesotho": "Africa/Maseru",
    "Liberia": "Africa/Monrovia",
    "Libya": "Africa/Tripoli",
    "Liechtenstein": "Europe/Vaduz",
    "Lithuania": "Europe/Vilnius",
    "Luxembourg": "Europe/Luxembourg",
    "Macao": "Asia/Macau",
    "Macedonia": "Europe/Skopje",
    "Madagascar": "Indian/Antananarivo",
    "Malawi": "Africa/Blantyre",
    "Maldives": "Indian/Maldives",
    "Mali": "Africa/Bamako",
    "Malta": "Europe/Malta",
    "Martinique": "America/Martinique",
    "Mauritania": "Africa/Nouakchott",
    "Mauritius": "Indian/Mauritius",
    "Mayotte": "Indian/Mayotte",
    "Moldova": "Europe/Chisinau",
    "Monaco": "Europe/Monaco",
    "Montenegro": "Europe/Podgorica",
    "Montserrat": "America/Montserrat",
    "Morocco": "Africa/Casablanca",
    "Mozambique": "Africa/Maputo",
    "Myanmar": "Asia/Rangoon",
    "Namibia": "Africa/Windhoek",
    "Nauru": "Pacific/Nauru",
    "Nepal": "Asia/Kathmandu",
    "Netherlands": "Europe/Amsterdam",
    "New Caledonia": "Pacific/Noumea",
    "Nicaragua": "America/Managua",
    "Niger": "Africa/Niamey",
    "Nigeria": "Africa/Lagos",
    "Niue": "Pacific/Niue",
    "Norfolk Island": "Pacific/Norfolk",
    "North Korea": "Asia/Pyongyang",
    "Northern Mariana Islands": "Pacific/Saipan",
    "Norway": "Europe/Oslo",
    "Oman": "Asia/Muscat",
    "Pakistan": "Asia/Karachi",
    "Palau": "Pacific/Palau",
    "Panama": "America/Panama",
    "Paraguay": "America/Asuncion",
    "Peru": "America/Lima",
    "Philippines": "Asia/Manila",
    "Pitcairn": "Pacific/Pitcairn",
    "Poland": "Europe/Warsaw",
    "Puerto Rico": "America/Puerto_Rico",
    "Qatar": "Asia/Qatar",
    "Republic of the Congo": "Africa/Brazzaville",
    "Reunion": "Indian/Reunion",
    "Romania": "Europe/Bucharest",
    "Rwanda": "Africa/Kigali",
    "Saint Barthélemy": "America/St_Barthelemy",
    "Saint Helena": "Atlantic/St_Helena",
    "Saint Kitts and Nevis": "America/St_Kitts",
    "Saint Lucia": "America/St_Lucia",
    "Saint Martin": "America/Marigot",
    "Saint Pierre and Miquelon": "America/Miquelon",
    "Saint Vincent and the Grenadines": "America/St_Vincent",
    "Samoa": "Pacific/Apia",
    "San Marino": "Europe/San_Marino",
    "Sao Tome and Principe": "Africa/Sao_Tome",
    "Saudi Arabia": "Asia/Riyadh",
    "Senegal": "Africa/Dakar",
    "Serbia": "Europe/Belgrade",
    "Seychelles": "Indian/Mahe",
    "Sierra Leone": "Africa/Freetown",
    "Singapore": "Asia/Singapore",
    "Sint Maarten": "America/Lower_Princes",
    "Slovakia": "Europe/Bratislava",
    "Slovenia": "Europe/Ljubljana",
    "Solomon Islands": "Pacific/Guadalcanal",
    "Somalia": "Africa/Mogadishu",
    "South Africa": "Africa/Johannesburg",
    "South Georgia and the South Sandwich Islands": "Atlantic/South_Georgia",
    "South Korea": "Asia/Seoul",
    "South Sudan": "Africa/Juba",
    "Sri Lanka": "Asia/Colombo",
    "Sudan": "Africa/Khartoum",
    "Suriname": "America/Paramaribo",
    "Svalbard and Jan Mayen": "Arctic/Longyearbyen",
    "Swaziland": "Africa/Mbabane",
    "Sweden": "Europe/Stockholm",
    "Switzerland": "Europe/Zurich",
    "Syria": "Asia/Damascus",
    "Taiwan": "Asia/Taipei",
    "Tajikistan": "Asia/Dushanbe",
    "Tanzania": "Africa/Dar_es_Salaam",
    "Thailand": "Asia/Bangkok",
    "Togo": "Africa/Lome",
    "Tokelau": "Pacific/Fakaofo",
    "Tonga": "Pacific/Tongatapu",
    "Trinidad and Tobago": "America/Port_of_Spain",
    "Tunisia": "Africa/Tunis",
    "Turkey": "Europe/Istanbul",
    "Turkmenistan": "Asia/Ashgabat",
    "Turks and Caicos Islands": "America/Grand_Turk",
    "Tuvalu": "Pacific/Funafuti",
    "U.S. Virgin Islands": "America/St_Thomas",
    "Uganda": "Africa/Kampala",
    "United Arab Emirates": "Asia/Dubai",
    "United Kingdom": "Europe/London",
    "UK": "Europe/London",
    "GB": "Europe/London",
    "Great Britain": "Europe/London",
    "Uruguay": "America/Montevideo",
    "Vanuatu": "Pacific/Efate",
    "Vatican": "Europe/Vatican",
    "Venezuela": "America/Caracas",
    "Vietnam": "Asia/Ho_Chi_Minh",
    "Wallis and Futuna": "Pacific/Wallis",
    "Western Sahara": "Africa/El_Aaiun",
    "Yemen": "Asia/Aden",
    "Zambia": "Africa/Lusaka",
    "Zimbabwe": "Africa/Harare",
    "Germany": "Europe/Berlin",
    "Busingen": "Europe/Busingen",
    "Germany, Busingen": "Europe/Busingen",
    "Galapagos": "Pacific/Galapagos",
    "Ecuador": "America/Guayaquil",
    "Chile": "America/Santiago",
    "Easter Island": "Pacific/Easter",
    "Spain": "Europe/Madrid",
    "Portugal": "Europe/Lisbon",
    "Madeira": "Atlantic/Madeira",
    "Azores": "Atlantic/Azores",
    "Ceuta": "Africa/Ceuta",
    "Canary": "Atlantic/Canary",
    "Antarctica, McMurdo": "Antarctica/McMurdo",
    "Antarctica, Rothera": "Antarctica/Rothera",
    "Antarctica, Palmer": "Antarctica/Palmer",
    "Antarctica, Mawson": "Antarctica/Mawson",
    "Antarctica, Davis": "Antarctica/Davis",
    "Antarctica, Casey": "Antarctica/Casey",
    "Antarctica, Vostok": "Antarctica/Vostok",
    "Antarctica, DumontDUrville": "Antarctica/DumontDUrville",
    "Antarctica, Syowa": "Antarctica/Syowa",
    "Antarctica, Troll": "Antarctica/Troll",
    "Antarctica, Macquarie": "Antarctica/Macquarie",
    "Argentina, Buenos Aires": "America/Argentina/Buenos_Aires",
    "Argentina, Cordoba": "America/Argentina/Cordoba",
    "Argentina, Salta": "America/Argentina/Salta",
    "Argentina, Jujuy": "America/Argentina/Jujuy",
    "Argentina, Tucuman": "America/Argentina/Tucuman",
    "Argentina, Catamarca": "America/Argentina/Catamarca",
    "Argentina, La Rioja": "America/Argentina/La_Rioja",
    "Argentina, San Juan": "America/Argentina/San_Juan",
    "Argentina, Mendoza": "America/Argentina/Mendoza",
    "Argentina, San Luis": "America/Argentina/San_Luis",
    "Argentina, Rio Gallegos": "America/Argentina/Rio_Gallegos",
    "Argentina, Ushuaia": "America/Argentina/Ushuaia",
    "Australia, Lord Howe": "Australia/Lord_Howe",
    "Australia, Hobart": "Australia/Hobart",
    "Australia, Currie": "Australia/Currie",
    "Australia, Melbourne": "Australia/Melbourne",
    "Australia, Sydney": "Australia/Sydney",
    "Australia, Broken Hill": "Australia/Broken_Hill",
    "Australia, Brisbane": "Australia/Brisbane",
    "Australia, Lindeman": "Australia/Lindeman",
    "Australia, Adelaide": "Australia/Adelaide",
    "Australia, Darwin": "Australia/Darwin",
    "Australia, Perth": "Australia/Perth",
    "Australia, Eucla": "Australia/Eucla",
    "Brazil, Noronha": "America/Noronha",
    "Brazil, Belem": "America/Belem",
    "Brazil, Fortaleza": "America/Fortaleza",
    "Brazil, Recife": "America/Recife",
    "Brazil, Araguaina": "America/Araguaina",
    "Brazil, Maceio": "America/Maceio",
    "Brazil, Bahia": "America/Bahia",
    "Brazil, Sao Paulo": "America/Sao_Paulo",
    "Brazil, Campo Grande": "America/Campo_Grande",
    "Brazil, Cuiaba": "America/Cuiaba",
    "Brazil, Santarem": "America/Santarem",
    "Brazil, Porto Velho": "America/Porto_Velho",
    "Brazil, Boa Vista": "America/Boa_Vista",
    "Brazil, Manaus": "America/Manaus",
    "Brazil, Eirunepe": "America/Eirunepe",
    "Brazil, Rio Branco": "America/Rio_Branco",
    "Canada, St_Johns": "America/St_Johns",
    "Canada, Halifax": "America/Halifax",
    "Canada, Glace Bay": "America/Glace_Bay",
    "Canada, Moncton": "America/Moncton",
    "Canada, Goose Bay": "America/Goose_Bay",
    "Canada, Blanc-Sablon": "America/Blanc-Sablon",
    "Canada, Toronto": "America/Toronto",
    "Canada, Nipigon": "America/Nipigon",
    "Canada, Thunder Bay": "America/Thunder_Bay",
    "Canada, Iqaluit": "America/Iqaluit",
    "Canada, Pangnirtung": "America/Pangnirtung",
    "Canada, Resolute": "America/Resolute",
    "Canada, Atikokan": "America/Atikokan",
    "Canada, Rankin Inlet": "America/Rankin_Inlet",
    "Canada, Winnipeg": "America/Winnipeg",
    "Canada, Rainy River": "America/Rainy_River",
    "Canada, Regina": "America/Regina",
    "Canada, Swift Current": "America/Swift_Current",
    "Canada, Edmonton": "America/Edmonton",
    "Canada, Cambridge Bay": "America/Cambridge_Bay",
    "Canada, Yellowknife": "America/Yellowknife",
    "Canada, Inuvik": "America/Inuvik",
    "Canada, Creston": "America/Creston",
    "Canada, Dawson Creek": "America/Dawson_Creek",
    "Canada, Vancouver": "America/Vancouver",
    "Canada, Whitehorse": "America/Whitehorse",
    "Canada, Dawson": "America/Dawson",
    "China, Shanghai": "Asia/Shanghai",
    "China, Urumqi": "Asia/Urumqi",
    "Congo, Kinshasa": "Africa/Kinshasa",
    "Congo, Lubumbashi": "Africa/Lubumbashi",
    "French Polynesia, Tahiti": "Pacific/Tahiti",
    "French Polynesia, Marquesas": "Pacific/Marquesas",
    "French Polynesia, Gambier": "Pacific/Gambier",
    "Greenland, Godthab": "America/Godthab",
    "Greenland, Danmarkshavn": "America/Danmarkshavn",
    "Greenland, Scoresbysund": "America/Scoresbysund",
    "Greenland, Thule": "America/Thule",
    "Indonesia, Jakarta": "Asia/Jakarta",
    "Indonesia, Pontianak": "Asia/Pontianak",
    "Indonesia, Makassar": "Asia/Makassar",
    "Indonesia, Jayapura": "Asia/Jayapura",
    "Kazakhstan, Almaty": "Asia/Almaty",
    "Kazakhstan, Qyzylorda": "Asia/Qyzylorda",
    "Kazakhstan, Aqtobe": "Asia/Aqtobe",
    "Kazakhstan, Aqtau": "Asia/Aqtau",
    "Kazakhstan, Oral": "Asia/Oral",
    "Kiribati, Tarawa": "Pacific/Tarawa",
    "Kiribati, Enderbury": "Pacific/Enderbury",
    "Kiribati, Kiritimati": "Pacific/Kiritimati",
    "Malaysia, Kuala Lumpur": "Asia/Kuala_Lumpur",
    "Malaysia, Kuching": "Asia/Kuching",
    "Marshall Islands, Majuro": "Pacific/Majuro",
    "Marshall Islands, Kwajalein": "Pacific/Kwajalein",
    "Mexico": "America/Mexico_City",
    "Mexico, Mexico City": "America/Mexico_City",
    "Mexico, Cancun": "America/Cancun",
    "Mexico, Merida": "America/Merida",
    "Mexico, Monterrey": "America/Monterrey",
    "Mexico, Matamoros": "America/Matamoros",
    "Mexico, Mazatlan": "America/Mazatlan",
    "Mexico, Chihuahua": "America/Chihuahua",
    "Mexico, Ojinaga": "America/Ojinaga",
    "Mexico, Hermosillo": "America/Hermosillo",
    "Mexico, Tijuana": "America/Tijuana",
    "Mexico, Santa Isabel": "America/Santa_Isabel",
    "Mexico, Bahia Banderas": "America/Bahia_Banderas",
    "Micronesia, Chuuk": "Pacific/Chuuk",
    "Micronesia, Pohnpei": "Pacific/Pohnpei",
    "Micronesia, Kosrae": "Pacific/Kosrae",
    "Mongolia, Ulaanbaatar": "Asia/Ulaanbaatar",
    "Mongolia, Hovd": "Asia/Hovd",
    "Mongolia, Choibalsan": "Asia/Choibalsan",
    "New Zealand, Auckland": "Pacific/Auckland",
    "New Zealand, Chatham": "Pacific/Chatham",
    "Palestina, Gaza": "Asia/Gaza",
    "Palestina, Hebron": "Asia/Hebron",
    "Papua New Guinea, Port_Moresby": "Pacific/Port_Moresby",
    "Papua New Guinea, Bougainville": "Pacific/Bougainville",
    "Russia, Kaliningrad": "Europe/Kaliningrad",
    "Russia, Moscow": "Europe/Moscow",
    "Russia, Simferopol": "Europe/Simferopol",
    "Russia, Volgograd": "Europe/Volgograd",
    "Russia, Samara": "Europe/Samara",
    "Russia, Yekaterinburg": "Asia/Yekaterinburg",
    "Russia, Omsk": "Asia/Omsk",
    "Russia, Novosibirsk": "Asia/Novosibirsk",
    "Russia, Novokuznetsk": "Asia/Novokuznetsk",
    "Russia, Krasnoyarsk": "Asia/Krasnoyarsk",
    "Russia, Irkutsk": "Asia/Irkutsk",
    "Russia, Chita": "Asia/Chita",
    "Russia, Yakutsk": "Asia/Yakutsk",
    "Russia, Khandyga": "Asia/Khandyga",
    "Russia, Vladivostok": "Asia/Vladivostok",
    "Russia, Sakhalin": "Asia/Sakhalin",
    "Russia, Ust-Nera": "Asia/Ust-Nera",
    "Russia, Magadan": "Asia/Magadan",
    "Russia, Srednekolymsk": "Asia/Srednekolymsk",
    "Russia, Kamchatka": "Asia/Kamchatka",
    "Russia, Anadyr": "Asia/Anadyr",
    "Ukraine, Kiev": "Europe/Kiev",
    "Ukraine, Uzhgorod": "Europe/Uzhgorod",
    "Ukraine, Zaporozhye": "Europe/Zaporozhye",
    "Uzbekistan, Samarkand": "Asia/Samarkand",
    "Uzbekistan, Tashkent": "Asia/Tashkent",
    "United States, New York": "America/New_York",
    "United States, Michigan - Detroit": "America/Detroit",
    "United States, Michigan - Menominee": "America/Menominee",
    "United States, Kentucky - Louisville": "America/Kentucky/Louisville",
    "United States, Kentucky - Monticello": "America/Kentucky/Monticello",
    "United States, Indiana - Indianapolis": "America/Indiana/Indianapolis",
    "United States, Indiana - Vincennes": "America/Indiana/Vincennes",
    "United States, Indiana - Winamac": "America/Indiana/Winamac",
    "United States, Indiana - Marengo": "America/Indiana/Marengo",
    "United States, Indiana - Petersburg": "America/Indiana/Petersburg",
    "United States, Indiana - Vevay": "America/Indiana/Vevay",
    "United States, Indiana - Tell City": "America/Indiana/Tell_City",
    "United States, Indiana - Knox": "America/Indiana/Knox",
    "United States, Illinois": "America/Chicago",
    "United States, North Dakota - Center": "America/North_Dakota/Center",
    "United States, North Dakota - New Salem": "America/North_Dakota/New_Salem",
    "United States, North Dakota - Beulah": "America/North_Dakota/Beulah",
    "United States, Colorado": "America/Denver",
    "United States, Idaho": "America/Boise",
    "United States, Arizona": "America/Phoenix",
    "United States, California": "America/Los_Angeles",
    "United States, Alaska - Metlakatla": "America/Metlakatla",
    "United States, Alaska - Anchorage": "America/Anchorage",
    "United States, Alaska - Juneau": "America/Juneau",
    "United States, Alaska - Sitka": "America/Sitka",
    "United States, Alaska - Yakutat": "America/Yakutat",
    "United States, Alaska - Nome": "America/Nome",
    "United States, Alaska - Adak": "America/Adak",
    "United States, Hawaii": "Pacific/Honolulu",
    "USA, New York": "America/New_York",
    "USA, Michigan - Detroit": "America/Detroit",
    "USA, Michigan - Menominee": "America/Menominee",
    "USA, Kentucky - Louisville": "America/Kentucky/Louisville",
    "USA, Kentucky - Monticello": "America/Kentucky/Monticello",
    "USA, Indiana - Indianapolis": "America/Indiana/Indianapolis",
    "USA, Indiana - Vincennes": "America/Indiana/Vincennes",
    "USA, Indiana - Winamac": "America/Indiana/Winamac",
    "USA, Indiana - Marengo": "America/Indiana/Marengo",
    "USA, Indiana - Petersburg": "America/Indiana/Petersburg",
    "USA, Indiana - Vevay": "America/Indiana/Vevay",
    "USA, Indiana - Tell City": "America/Indiana/Tell_City",
    "USA, Indiana - Knox": "America/Indiana/Knox",
    "USA, Illinois": "America/Chicago",
    "USA, North Dakota - Center": "America/North_Dakota/Center",
    "USA, North Dakota - New Salem": "America/North_Dakota/New_Salem",
    "USA, North Dakota - Beulah": "America/North_Dakota/Beulah",
    "USA, Colorado": "America/Denver",
    "USA, Idaho": "America/Boise",
    "USA, Arizona": "America/Phoenix",
    "USA, California": "America/Los_Angeles",
    "USA, Alaska - Metlakatla": "America/Metlakatla",
    "USA, Alaska - Anchorage": "America/Anchorage",
    "USA, Alaska - Juneau": "America/Juneau",
    "USA, Alaska - Sitka": "America/Sitka",
    "USA, Alaska - Yakutat": "America/Yakutat",
    "USA, Alaska - Nome": "America/Nome",
    "USA, Alaska - Adak": "America/Adak",
    "USA, Hawaii": "Pacific/Honolulu",
    "Hawaii": "Pacific/Honolulu",
    "USA, Eastern Time": "America/New_York",
    "USA, Central Time": "America/Chicago",
    "USA, Mountain Time": "America/Denver",
    "USA, Pacific Time": "America/Los_Angeles",
    "GMT": "Africa/Dakar",
    "UTC": "Africa/Dakar",
    "CET": "Europe/Berlin",
    "CEST": "Europe/Berlin"
};
var Ajax;
(function (Ajax) {
    function get(url, success, failure) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.timeout = 3000;
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                if (xhr.status >= 200 && xhr.status < 400) {
                    if (typeof success == 'function')
                        success(xhr.responseText);
                }
                else {
                    if (typeof failure == 'function')
                        failure(xhr.status);
                }
            }
        };
        xhr.onerror = function () {
            if (typeof failure == 'function')
                failure(-1);
        };
        xhr.send();
    }
    Ajax.get = get;
})(Ajax || (Ajax = {}));
var Tzork;
(function (Tzork) {
    var TzResolver;
    (function (TzResolver) {
        var people_loading = 0;
        var _tzcache = null;
        function _getTzFromCache(tz) {
            if (_tzcache == null) {
                var hit = localStorage['tz_cache'];
                if (hit) {
                    try {
                        _tzcache = JSON.parse(hit);
                        if (_tzcache === null) {
                            _tzcache = {};
                        }
                    }
                    catch (e) {
                        _tzcache = {};
                    }
                }
                else {
                    _tzcache = {};
                }
            }
            return Utils.objGet(_tzcache, tz, null);
        }
        function _addTzToCache(tz, _tz) {
            _tzcache[tz] = _tz;
            localStorage['tz_cache'] = JSON.stringify(_tzcache);
        }
        function resolvePointTimezones(points, onDone) {
            points.forEach(function (obj) {
                obj._valid = true;
                var bad = false;
                ['name', 'color', 'tz'].forEach(function (e) {
                    if (!Utils.keyExists(obj, e)) {
                        console.error('Missing "' + e + '" field in point object', obj);
                        bad = true;
                    }
                });
                if (bad) {
                    obj._valid = false;
                    return;
                }
                Utils.setIfMissing(obj, 'show', true);
                people_loading++;
                _resolveTimezone(obj);
            });
            (function probe() {
                if (people_loading <= 0) {
                    onDone();
                    return;
                }
                setTimeout(probe, 5);
            })();
        }
        TzResolver.resolvePointTimezones = resolvePointTimezones;
        function _resolveTimezone(obj) {
            obj._tz = obj.tz;
            if (obj.tz in tz_aliases) {
                obj._tz = tz_aliases[obj.tz];
                console.log('TZ "' + obj.tz + '" resolved as "' + obj._tz + '"');
            }
            var fromcache = _getTzFromCache(obj.tz);
            if (fromcache) {
                obj._tz = fromcache;
            }
            if (moment.tz.zone(obj._tz)) {
                people_loading--;
                return;
            }
            _scheduleGoogleReq(obj);
        }
        var last_google_call_timestamp = 0;
        function _scheduleGoogleReq(obj) {
            var elapsed = (Date.now() - last_google_call_timestamp);
            var t = Math.max(0, (105 - elapsed));
            if (t == 0) {
                last_google_call_timestamp = Date.now();
                _getTimezoneFromGoogleAPIs(obj);
                return;
            }
            setTimeout(function () {
                _scheduleGoogleReq(obj);
            }, t);
        }
        function _getTimezoneFromGoogleAPIs(obj) {
            var geoURL = "https://maps.googleapis.com/maps/api/geocode/json?sensor=false&address=" + encodeURIComponent(obj.tz);
            function ajaxFail(resp) {
                console.log('FAIL: code ' + resp);
                obj._valid = false;
                people_loading--;
            }
            function geoOK(resp) {
                try {
                    var rj = JSON.parse(resp);
                    console.log('Reply from geoAPI:', rj);
                    if (rj.status !== 'OK') {
                        obj._valid = false;
                        people_loading--;
                        return;
                    }
                    var results = rj.results;
                    if (results.length > 1) {
                        console.error('WARNING: Google found multiple matches. Try to be more specific at "' + obj.tz + '"');
                    }
                    var loc = results[0].geometry.location;
                    var now = Math.floor(Date.now() / 1000);
                    var tzURL = "https://maps.googleapis.com/maps/api/timezone/json?location=" + loc.lat + "," + loc.lng + "&timestamp=" + now + "&sensor=false";
                    Ajax.get(tzURL, tzOK, ajaxFail);
                }
                catch (e) {
                    console.log(e);
                    obj._valid = false;
                    people_loading--;
                }
            }
            function tzOK(resp) {
                try {
                    var rj = JSON.parse(resp);
                    console.log('Reply from Google:', rj);
                    if (rj.status !== 'OK') {
                        obj._valid = false;
                        people_loading--;
                        return;
                    }
                    console.log('Resolved TZ as ' + rj.timeZoneId);
                    obj._tz = rj.timeZoneId;
                    _addTzToCache(obj.tz, obj._tz);
                    people_loading--;
                }
                catch (e) {
                    console.log(e);
                    obj._valid = false;
                    people_loading--;
                }
            }
            Ajax.get(geoURL, geoOK, ajaxFail);
        }
        function getTimeForPoint(obj) {
            var mmt = moment().tz(obj._tz);
            return mmt.hour() * 3600 + mmt.minute() * 60 + mmt.second();
        }
        TzResolver.getTimeForPoint = getTimeForPoint;
    })(TzResolver = Tzork.TzResolver || (Tzork.TzResolver = {}));
})(Tzork || (Tzork = {}));
if (!Date.now) {
    Date.now = function () {
        return new Date().getTime();
    };
}
var Utils;
(function (Utils) {
    function clamp(what, low, high) {
        return Math.max(low, Math.min(high, what));
    }
    Utils.clamp = clamp;
    function hour2angle(h) {
        var a = (18 - h) * 15;
        while (a < 0)
            a += 360;
        return a;
    }
    Utils.hour2angle = hour2angle;
    function positionAt(element, angle, distance, octant) {
        if (octant === void 0) { octant = 0; }
        var xx = (distance * Math.cos((angle / 180) * Math.PI));
        var yy = (distance * Math.sin((angle / 180) * Math.PI));
        switch (octant) {
            case 0:
            case 1:
            case 7:
                element.style.left = (50 + xx) + '%';
                element.style.top = (50 - yy) + '%';
                break;
            case 2:
            case 3:
            case 4:
                element.style.right = (50 - xx) + '%';
                element.style.top = (50 - yy) + '%';
                break;
            case 5:
                element.style.right = (50 - xx) + '%';
                element.style.bottom = (50 + yy) + '%';
                break;
            case 6:
                element.style.left = (50 + xx) + '%';
                element.style.bottom = (50 + yy) + '%';
                break;
        }
    }
    Utils.positionAt = positionAt;
    function positionAtPx(element, angle, distance, fullw, offs, octant) {
        if (octant === void 0) { octant = 0; }
        var xx = (distance * Math.cos((angle / 180) * Math.PI));
        var yy = (distance * Math.sin((angle / 180) * Math.PI));
        switch (octant) {
            case 0:
            case 1:
            case 7:
                element.style.left = Math.round(fullw / 2 + xx + offs) + 'px';
                element.style.top = Math.round(fullw / 2 - yy + offs) + 'px';
                break;
            case 2:
            case 3:
            case 4:
                element.style.right = Math.round(fullw / 2 - xx + offs) + 'px';
                element.style.top = Math.round(fullw / 2 - yy + offs) + 'px';
                break;
            case 5:
                element.style.right = Math.round(fullw / 2 - xx + offs) + 'px';
                element.style.bottom = Math.round(fullw / 2 + yy + offs) + 'px';
                break;
            case 6:
                element.style.left = Math.round(fullw / 2 + xx + offs) + 'px';
                element.style.bottom = Math.round(fullw / 2 + yy + offs) + 'px';
                break;
        }
    }
    Utils.positionAtPx = positionAtPx;
    function mmtDayCompare(here, there) {
        var d0 = here.dayOfYear();
        var y0 = here.year();
        var d1 = there.dayOfYear();
        var y1 = there.year();
        if (y1 < y0) {
            return -1;
        }
        else if (y1 > y0) {
            return 1;
        }
        else {
            if (d1 < d0) {
                return -1;
            }
            else if (d1 > d0) {
                return 1;
            }
        }
        return 0;
    }
    Utils.mmtDayCompare = mmtDayCompare;
    function iterateQuery(query, func) {
        var outers = document.querySelectorAll(query);
        for (var i = 0; i < outers.length; i++) {
            var e = outers[i];
            func(e);
        }
    }
    Utils.iterateQuery = iterateQuery;
    function queryOne(query) {
        return document.querySelector(query);
    }
    Utils.queryOne = queryOne;
    function setIfMissing(obj, key, value) {
        if (!keyExists(obj, key)) {
            obj[key] = value;
        }
    }
    Utils.setIfMissing = setIfMissing;
    function keyExists(x, key) {
        return typeof (x[key]) != 'undefined';
    }
    Utils.keyExists = keyExists;
    function objGet(obj, key, def) {
        if (!keyExists(obj, key))
            return def;
        return obj[key];
    }
    Utils.objGet = objGet;
    function fixTextareaTabKey() {
        var textareas = document.getElementsByTagName('textarea');
        var count = textareas.length;
        for (var i = 0; i < count; i++) {
            textareas[i].onkeydown = function (e) {
                if (e.keyCode == 9 || e.which == 9) {
                    e.preventDefault();
                    var s = this.selectionStart;
                    this.value = this.value.substring(0, this.selectionStart) + "\t" + this.value.substring(this.selectionEnd);
                    this.selectionEnd = s + 1;
                }
            };
        }
    }
    Utils.fixTextareaTabKey = fixTextareaTabKey;
    function hoverMenu(button, menu) {
        var menuopen = false;
        var closemenutimeout;
        $(button).on('mouseover', function () {
            $(menu).removeClass('gone');
            menuopen = true;
            clearTimeout(closemenutimeout);
        });
        $(menu).on('mouseover', function () {
            clearTimeout(closemenutimeout);
        });
        function outhandler() {
            closemenutimeout = setTimeout(function () {
                $(menu).addClass('gone');
                menuopen = false;
            }, 10);
        }
        $(menu).on('mouseout', outhandler);
        $(button).on('mouseout', outhandler);
    }
    Utils.hoverMenu = hoverMenu;
    function rgb2hsb(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;
        var minVal = Math.min(r, g, b), maxVal = Math.max(r, g, b), delta = maxVal - minVal, HSB = { h: 0, s: 0, b: maxVal }, del_R, del_G, del_B;
        if (delta !== 0) {
            HSB.s = delta / maxVal;
            del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;
            del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;
            del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;
            if (r === maxVal) {
                HSB.h = del_B - del_G;
            }
            else if (g === maxVal) {
                HSB.h = (1 / 3) + del_R - del_B;
            }
            else if (b === maxVal) {
                HSB.h = (2 / 3) + del_G - del_R;
            }
            if (HSB.h < 0) {
                HSB.h += 1;
            }
            if (HSB.h > 1) {
                HSB.h -= 1;
            }
        }
        HSB.h *= 360;
        HSB.s *= 100;
        HSB.b *= 100;
        return HSB;
    }
    Utils.rgb2hsb = rgb2hsb;
    function isColorDark(r, g, b) {
        return (((r * 299) + (g * 587) + (b * 114)) / 1000) < 128;
    }
    Utils.isColorDark = isColorDark;
    function applyStylesheet(id, css) {
        var oldstyle = document.getElementById(id);
        if (oldstyle) {
            oldstyle.parentElement.removeChild(oldstyle);
        }
        var sty = document.createElement('style');
        sty.type = 'text/css';
        sty.innerHTML = css;
        sty.id = id;
        document.head.appendChild(sty);
    }
    Utils.applyStylesheet = applyStylesheet;
})(Utils || (Utils = {}));
var tz_def_profile = {
    "title": "My Tzork",
    "showTitle": true,
    "innerImage": "images/bg-earth.jpg",
    "innerColor": "",
    "outerImage": "",
    "outerColor": "",
    "fgColor": "",
    "labelShadows": true,
    "labelHoverBg": '',
    "menuColor": '',
    "points": [
        {
            "name": "@MightyPork",
            "tz": "Czech Republic",
            "color": "#FFAD00",
            "show": true
        },
        {
            "name": "@AntonvonRaumer",
            "tz": "Germany",
            "color": "#FF8585",
            "show": true
        },
        {
            "name": "@ciba43",
            "tz": "Latvia",
            "color": "#FE2F77",
            "show": true
        },
        {
            "name": "@coolsquid_",
            "tz": "Norway",
            "color": "#079DE9",
            "show": true
        },
        {
            "name": "@Creeper32605",
            "tz": "Denmark",
            "color": "#C8F080",
            "show": true
        },
        {
            "name": "@Deli731234",
            "tz": "USA, Pacific Time",
            "color": "#A659E2",
            "show": true
        },
        {
            "name": "@eevblog",
            "tz": "Australia, Sydney",
            "color": "#E63E3F",
            "show": true
        },
        {
            "name": "@elakdawalla",
            "tz": "USA, Pacific Time",
            "color": "#C49B6D",
            "show": true
        },
        {
            "name": "@iamSethD",
            "tz": "USA, Eastern Time",
            "color": "#ED2222",
            "show": true
        },
        {
            "name": "@ImReble548",
            "tz": "USA, Mountain Time",
            "color": "#69E79E",
            "show": true
        },
        {
            "name": "@Jaredlll08",
            "tz": "South Africa",
            "color": "#F86752",
            "show": true
        },
        {
            "name": "@JesperJacoben",
            "tz": "Denmark",
            "color": "skyblue",
            "show": true
        },
        {
            "name": "@lastofavari",
            "tz": "Belarus",
            "color": "#05CDC0",
            "show": true
        },
        {
            "name": "@ljfa2",
            "tz": "Germany",
            "color": "#78FCFF",
            "show": true
        },
        {
            "name": "@Locercus",
            "tz": "Denmark",
            "color": "#32CD32",
            "show": true
        },
        {
            "name": "@Lunatrius",
            "tz": "Slovenia",
            "color": "#00CCFF",
            "show": true
        },
        {
            "name": "@Rafmaninoff",
            "tz": "Spain",
            "color": "#00CC00",
            "show": true
        },
        {
            "name": "@TheBadFame",
            "tz": "Mexico",
            "color": "#329AFF",
            "show": true
        },
        {
            "name": "@Vangoule273",
            "tz": "United Kingdom",
            "color": "#00FF2C",
            "show": true
        },
        {
            "name": "@xTordX",
            "tz": "Romania",
            "color": "#AE1AF7",
            "show": true
        }
    ]
};
var Tzork;
(function (Tzork) {
    var Data;
    (function (Data) {
        function stripProfile(p) {
            p = JSON.parse(JSON.stringify(p));
            delete p._valid;
            p.points.forEach(function (gp) {
                delete gp._t;
                delete gp._tz;
                delete gp._valid;
            });
            return p;
        }
        Data.stripProfile = stripProfile;
        function createEmptyProfile() {
            return {
                title: 'Tzork Profile',
                showTitle: true,
                innerImage: 'images/bg-earth.jpg',
                innerColor: '',
                outerImage: '',
                outerColor: '#0B1A2E',
                fgColor: '',
                labelShadows: true,
                labelHoverBg: '',
                menuColor: '',
                points: [
                    {
                        name: '@MightyPork',
                        tz: 'Europe/Prague',
                        color: 'orange',
                        show: true
                    }
                ]
            };
        }
        Data.createEmptyProfile = createEmptyProfile;
        function createDefaultProfile() {
            return JSON.parse(JSON.stringify(tz_def_profile));
        }
        Data.createDefaultProfile = createDefaultProfile;
        var LocalRepository = (function () {
            function LocalRepository() {
                this.profiles = [];
                this.activeProfile = 0;
            }
            LocalRepository.prototype.getActiveProfile = function () {
                return this.profiles[this.activeProfile];
            };
            LocalRepository.prototype.load = function (onDone) {
                try {
                    var s = localStorage['repository'];
                    if (s != null) {
                        var j = JSON.parse(s);
                        this.profiles = j.profiles || [];
                        this.activeProfile = parseInt(j.active);
                    }
                }
                catch (e) {
                    console.error('Error reading profiles from localStorage', e);
                }
                this.parse(onDone);
            };
            LocalRepository.prototype.parse = function (onDone) {
                var must_save = false;
                if (this.profiles.length == 0) {
                    if (Utils.keyExists(localStorage, 'people')) {
                        var p = createDefaultProfile();
                        p.points = JSON.parse(localStorage['people']);
                        this.profiles.push(p);
                        delete localStorage['people'];
                    }
                    else {
                        this.profiles.push(createDefaultProfile());
                    }
                    must_save = true;
                }
                this.activeProfile = Utils.clamp(this.activeProfile, 0, this.profiles.length - 1);
                var loading = 0;
                this.profiles.forEach(function (p) {
                    Utils.setIfMissing(p, 'points', []);
                    Utils.setIfMissing(p, 'showTitle', true);
                    Utils.setIfMissing(p, 'innerImage', '');
                    Utils.setIfMissing(p, 'innerColor', '');
                    Utils.setIfMissing(p, 'outerImage', '');
                    Utils.setIfMissing(p, 'outerColor', '');
                    Utils.setIfMissing(p, 'fgColor', '');
                    Utils.setIfMissing(p, 'labelShadows', true);
                    Utils.setIfMissing(p, 'labelHoverBg', '');
                    Utils.setIfMissing(p, 'menuColor', '');
                    loading++;
                    Tzork.TzResolver.resolvePointTimezones(p.points, function () {
                        loading--;
                    });
                });
                var self = this;
                (function probe() {
                    if (loading == 0) {
                        if (must_save) {
                            self.store();
                        }
                        (typeof onDone == 'function') && onDone();
                    }
                    else {
                        setTimeout(probe, 5);
                    }
                })();
            };
            LocalRepository.prototype.store = function (onDone) {
                var outp = [];
                this.profiles.forEach(function (pr) {
                    outp.push(stripProfile(pr));
                });
                localStorage['repository'] = JSON.stringify({
                    profiles: outp,
                    active: this.activeProfile
                });
                (typeof onDone == 'function') && onDone();
            };
            return LocalRepository;
        })();
        Data.LocalRepository = LocalRepository;
        var LocalConfigProvider = (function () {
            function LocalConfigProvider() {
                this.local = null;
            }
            LocalConfigProvider.prototype._read = function () {
                if (!this.local) {
                    try {
                        var t = localStorage['config'];
                        var j = JSON.parse(t);
                        this.local = j || {};
                    }
                    catch (e) {
                        this.local = {};
                    }
                }
            };
            LocalConfigProvider.prototype.get = function (key, defval) {
                this._read();
                return Utils.objGet(this.local, key, defval);
            };
            LocalConfigProvider.prototype.set = function (key, value) {
                this._read();
                this.local[key] = value;
                localStorage['config'] = JSON.stringify(this.local);
            };
            LocalConfigProvider.prototype.setIfMissing = function (key, value) {
                if (!Utils.keyExists(this.local, key)) {
                    this.set(key, value);
                }
            };
            return LocalConfigProvider;
        })();
        Data.LocalConfigProvider = LocalConfigProvider;
    })(Data = Tzork.Data || (Tzork.Data = {}));
})(Tzork || (Tzork = {}));
var RGBColor = (function () {
    function RGBColor(color_string) {
        this.ok = false;
        if (color_string.charAt(0) == '#') {
            color_string = color_string.substr(1, 6);
        }
        color_string = color_string.replace(/ /g, '');
        color_string = color_string.toLowerCase();
        if (RGBColor.simple_colors.hasOwnProperty(color_string)) {
            color_string = RGBColor.simple_colors[color_string];
        }
        var color_defs = [
            {
                re: /^(\w{2})(\w{2})(\w{2})$/,
                process: function (bits) {
                    return [
                        parseInt(bits[1], 16),
                        parseInt(bits[2], 16),
                        parseInt(bits[3], 16)
                    ];
                }
            },
            {
                re: /^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,
                process: function (bits) {
                    return [
                        parseInt(bits[1]),
                        parseInt(bits[2]),
                        parseInt(bits[3])
                    ];
                }
            },
            {
                re: /^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(?:[\d.]+)\)$/,
                process: function (bits) {
                    return [
                        parseInt(bits[1]),
                        parseInt(bits[2]),
                        parseInt(bits[3])
                    ];
                }
            },
            {
                re: /^(\w{1})(\w{1})(\w{1})$/,
                process: function (bits) {
                    return [
                        parseInt(bits[1] + bits[1], 16),
                        parseInt(bits[2] + bits[2], 16),
                        parseInt(bits[3] + bits[3], 16)
                    ];
                }
            }
        ];
        for (var i = 0; i < color_defs.length; i++) {
            var re = color_defs[i].re;
            var processor = color_defs[i].process;
            var bits = re.exec(color_string);
            if (bits) {
                var channels = processor(bits);
                this.r = channels[0];
                this.g = channels[1];
                this.b = channels[2];
                this.ok = true;
            }
        }
        this.r = (this.r < 0 || isNaN(this.r)) ? 0 : ((this.r > 255) ? 255 : this.r);
        this.g = (this.g < 0 || isNaN(this.g)) ? 0 : ((this.g > 255) ? 255 : this.g);
        this.b = (this.b < 0 || isNaN(this.b)) ? 0 : ((this.b > 255) ? 255 : this.b);
    }
    RGBColor.prototype.toRGB = function () {
        return 'rgb(' + this.r + ',' + this.g + ',' + this.b + ')';
    };
    RGBColor.prototype.toRGBA = function (a) {
        return 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + a + ')';
    };
    RGBColor.prototype.toHex = function () {
        var r = this.r.toString(16);
        var g = this.g.toString(16);
        var b = this.b.toString(16);
        if (r.length == 1)
            r = '0' + r;
        if (g.length == 1)
            g = '0' + g;
        if (b.length == 1)
            b = '0' + b;
        return '#' + r + g + b;
    };
    RGBColor.simple_colors = {
        aliceblue: 'f0f8ff',
        antiquewhite: 'faebd7',
        aqua: '00ffff',
        aquamarine: '7fffd4',
        azure: 'f0ffff',
        beige: 'f5f5dc',
        bisque: 'ffe4c4',
        black: '000000',
        blanchedalmond: 'ffebcd',
        blue: '0000ff',
        blueviolet: '8a2be2',
        brown: 'a52a2a',
        burlywood: 'deb887',
        cadetblue: '5f9ea0',
        chartreuse: '7fff00',
        chocolate: 'd2691e',
        coral: 'ff7f50',
        cornflowerblue: '6495ed',
        cornsilk: 'fff8dc',
        crimson: 'dc143c',
        cyan: '00ffff',
        darkblue: '00008b',
        darkcyan: '008b8b',
        darkgoldenrod: 'b8860b',
        darkgray: 'a9a9a9',
        darkgreen: '006400',
        darkkhaki: 'bdb76b',
        darkmagenta: '8b008b',
        darkolivegreen: '556b2f',
        darkorange: 'ff8c00',
        darkorchid: '9932cc',
        darkred: '8b0000',
        darksalmon: 'e9967a',
        darkseagreen: '8fbc8f',
        darkslateblue: '483d8b',
        darkslategray: '2f4f4f',
        darkturquoise: '00ced1',
        darkviolet: '9400d3',
        deeppink: 'ff1493',
        deepskyblue: '00bfff',
        dimgray: '696969',
        dodgerblue: '1e90ff',
        feldspar: 'd19275',
        firebrick: 'b22222',
        floralwhite: 'fffaf0',
        forestgreen: '228b22',
        fuchsia: 'ff00ff',
        gainsboro: 'dcdcdc',
        ghostwhite: 'f8f8ff',
        gold: 'ffd700',
        goldenrod: 'daa520',
        gray: '808080',
        green: '008000',
        greenyellow: 'adff2f',
        honeydew: 'f0fff0',
        hotpink: 'ff69b4',
        indianred: 'cd5c5c',
        indigo: '4b0082',
        ivory: 'fffff0',
        khaki: 'f0e68c',
        lavender: 'e6e6fa',
        lavenderblush: 'fff0f5',
        lawngreen: '7cfc00',
        lemonchiffon: 'fffacd',
        lightblue: 'add8e6',
        lightcoral: 'f08080',
        lightcyan: 'e0ffff',
        lightgoldenrodyellow: 'fafad2',
        lightgrey: 'd3d3d3',
        lightgreen: '90ee90',
        lightpink: 'ffb6c1',
        lightsalmon: 'ffa07a',
        lightseagreen: '20b2aa',
        lightskyblue: '87cefa',
        lightslateblue: '8470ff',
        lightslategray: '778899',
        lightsteelblue: 'b0c4de',
        lightyellow: 'ffffe0',
        lime: '00ff00',
        limegreen: '32cd32',
        linen: 'faf0e6',
        magenta: 'ff00ff',
        maroon: '800000',
        mediumaquamarine: '66cdaa',
        mediumblue: '0000cd',
        mediumorchid: 'ba55d3',
        mediumpurple: '9370d8',
        mediumseagreen: '3cb371',
        mediumslateblue: '7b68ee',
        mediumspringgreen: '00fa9a',
        mediumturquoise: '48d1cc',
        mediumvioletred: 'c71585',
        midnightblue: '191970',
        mintcream: 'f5fffa',
        mistyrose: 'ffe4e1',
        moccasin: 'ffe4b5',
        navajowhite: 'ffdead',
        navy: '000080',
        oldlace: 'fdf5e6',
        olive: '808000',
        olivedrab: '6b8e23',
        orange: 'ffa500',
        orangered: 'ff4500',
        orchid: 'da70d6',
        palegoldenrod: 'eee8aa',
        palegreen: '98fb98',
        paleturquoise: 'afeeee',
        palevioletred: 'd87093',
        papayawhip: 'ffefd5',
        peachpuff: 'ffdab9',
        peru: 'cd853f',
        pink: 'ffc0cb',
        plum: 'dda0dd',
        powderblue: 'b0e0e6',
        purple: '800080',
        red: 'ff0000',
        rosybrown: 'bc8f8f',
        royalblue: '4169e1',
        saddlebrown: '8b4513',
        salmon: 'fa8072',
        sandybrown: 'f4a460',
        seagreen: '2e8b57',
        seashell: 'fff5ee',
        sienna: 'a0522d',
        silver: 'c0c0c0',
        skyblue: '87ceeb',
        slateblue: '6a5acd',
        slategray: '708090',
        snow: 'fffafa',
        springgreen: '00ff7f',
        steelblue: '4682b4',
        tan: 'd2b48c',
        teal: '008080',
        thistle: 'd8bfd8',
        tomato: 'ff6347',
        turquoise: '40e0d0',
        violet: 'ee82ee',
        violetred: 'd02090',
        wheat: 'f5deb3',
        white: 'ffffff',
        whitesmoke: 'f5f5f5',
        yellow: 'ffff00',
        yellowgreen: '9acd32'
    };
    return RGBColor;
})();
var Tzork;
(function (Tzork) {
    function applyThemeFromProfile() {
        var css = '';
        var prof = Tzork.theRepo.profiles[Tzork.theRepo.activeProfile];
        var out_i, out_c;
        out_i = prof.outerImage ? 'url(\"' + prof.outerImage + '\")' : 'none';
        out_c = prof.outerColor || '#07151D';
        css += '.theme-outer {background-color: ' + out_c + '; background-image: ' + out_i + '}';
        var in_c, in_i;
        in_i = prof.innerImage ? 'url(\"' + prof.innerImage + '\")' : 'none';
        in_c = prof.innerColor || 'transparent';
        css += '.theme-inner {background-color: ' + in_c + '; background-image: ' + in_i + '}';
        var color = prof.fgColor || '#9cfff7';
        css += '.theme-fg {color: ' + color + '}';
        if (!prof.labelShadows) {
            css += '.person-label {text-shadow: none}';
        }
        if (prof.labelHoverBg) {
            css += '.people-list:hover {background-color:' + prof.labelHoverBg + '}';
        }
        var rc = new RGBColor(color);
        var isFgDark = Utils.isColorDark(rc.r, rc.g, rc.b);
        var rc = new RGBColor(in_c);
        var isInBgDark = Utils.isColorDark(rc.r, rc.g, rc.b);
        var rc = new RGBColor(out_c);
        var isOutBgDark = Utils.isColorDark(rc.r, rc.g, rc.b);
        if (isFgDark) {
            if (in_i == 'none' && out_i == 'none' && (in_c != 'transparent' && !isInBgDark) && (!isOutBgDark)) {
                css += '#disc {box-shadow: none}';
            }
            else {
                css += '#disc {box-shadow: 0 0 3px 1px white, inset 0 0 3px 1px white}';
            }
            css += '.bullet {box-shadow: 0 0 4px white}';
            if (in_i == 'none' && ((in_c != 'transparent' && !isInBgDark) || (in_c == 'transparent' && (out_i == 'none' && !isOutBgDark)))) {
                css += '.mark {text-shadow: none}';
                css += '#time-box {text-shadow: none}';
            }
            else {
                css += '.mark {text-shadow: 0 0 3px white, 0 0 6px white}';
                css += '#time-box {text-shadow: 0 0 8px white, 0 0 4px white}';
            }
        }
        if (prof.menuColor) {
            color = prof.menuColor;
        }
        rc = new RGBColor(color);
        css += '#menubar {color: ' + color + '}';
        css += '.profiles-menu a {background-color: ' + rc.toRGBA(.1) + '}';
        css += '.profiles-menu a:hover {background-color: ' + rc.toRGBA(.2) + '}';
        Utils.applyStylesheet('theme-styles', css);
    }
    Tzork.applyThemeFromProfile = applyThemeFromProfile;
})(Tzork || (Tzork = {}));
var Tzork;
(function (Tzork) {
    var Clock = (function () {
        function Clock() {
            var _this = this;
            this.disc = document.getElementById('disc');
            this._updateTime();
            this.interval_time = setInterval(this._updateTime, 1000);
            var resizeClock = function () {
                var w = window.innerWidth;
                var h = window.innerHeight;
                var s_full = Math.round(Math.min(w, h)) * 1.2;
                var fs_full = Math.round(s_full * 0.0185);
                w -= fs_full * 19;
                h -= fs_full * 8;
                var s = Math.round(Math.min(w, h));
                if (s % 2)
                    s++;
                _this.setDiskSize(s);
                var fs = Math.round(s * 0.025);
                if (fs < 8)
                    fs = 8;
                var css = '#disc {font-size:' + fs + 'px}';
                if (s < 250) {
                    css += '.mark {font-size:1.4em}.mark.sixth{font-size:1.8em}';
                    css += '#time-box {font-size: .6em;}';
                }
                Utils.applyStylesheet('size-style', css);
            };
            window.onresize = resizeClock;
            resizeClock();
            this.loadActiveProfile();
        }
        Clock.prototype.setDiskSize = function (size) {
            this.disc.style.width = size + "px";
            this.disc.style.height = size + "px";
            this.discSize = size;
            this.updatePoints();
            this._buildClockMarks();
        };
        Clock.prototype.loadActiveProfile = function () {
            this.clear();
            this._populate();
        };
        Clock.prototype._populate = function () {
            var _this = this;
            var profile = Tzork.theRepo.getActiveProfile();
            console.log('Populate with profile: ', profile);
            Tzork.applyThemeFromProfile();
            var lbl = Utils.queryOne('#profile-label');
            lbl.textContent = profile.title;
            lbl.style.display = profile.showTitle ? 'block' : 'none';
            this.updatePoints();
            this.interval_people = setInterval(function () {
                _this.updatePoints();
            }, 1000 * 10);
            window.onfocus = function () {
                _this.updatePoints();
                _this._updateTime();
            };
        };
        Clock.prototype.clear = function () {
            var old = document.querySelectorAll('.bullet, .person-label, .people-list');
            for (var i = 0; i < old.length; i++) {
                old[i].parentNode.removeChild(old[i]);
            }
            clearInterval(this.interval_people);
        };
        Clock.prototype._buildClockMarks = function () {
            var old = document.querySelectorAll('.mark');
            for (var i = 0; i < old.length; i++) {
                old[i].parentNode.removeChild(old[i]);
            }
            var twelve = Tzork.theConfig.get('twelve', false);
            var bdrW = parseInt(window.getComputedStyle(this.disc).borderRightWidth.replace('px', ''));
            for (var i = 0; i < 24; i++) {
                var mark = document.createElement('div');
                mark.classList.add('mark');
                mark.classList.add('hour-' + i);
                if (i == 0 || i == 6 || i == 12 || i == 18) {
                    mark.classList.add('sixth');
                }
                if (twelve) {
                    var j = i;
                    if (j > 12)
                        j -= 12;
                    mark.textContent = '' + j;
                }
                else {
                    mark.textContent = '' + i;
                }
                var angle = Utils.hour2angle(i);
                Utils.positionAtPx(mark, angle, (this.discSize / 2) * 0.88, this.discSize, -bdrW);
                this.disc.appendChild(mark);
            }
        };
        Clock.prototype._updateTime = function () {
            var mmt = moment();
            var t = mmt.format('H:mm');
            if (t !== this.last_time) {
                this.last_time = t;
                var parts = t.split(':');
                document.getElementById('local-time').innerHTML = parts[0] + '<span id="local-time-colon">:</span>' + parts[1];
            }
            var s = (new Date()).getSeconds() % 2;
            document.getElementById('local-time-colon').style.visibility = s ? 'visible' : 'hidden';
        };
        Clock.prototype.updatePoints = function () {
            if (this.mouse_on_list) {
                console.log('Mouse over list, not redrawing.');
                return;
            }
            var x = document.querySelectorAll('.bullet, .person, .people-list');
            for (var i in x) {
                if (x.hasOwnProperty(i)) {
                    var e = x[i];
                    if (!e || !e.parentNode)
                        continue;
                    e.parentNode.removeChild(e);
                }
            }
            this._buildPoints();
        };
        Clock.prototype._buildPoints = function () {
            var _this = this;
            var resolved = [];
            var p = Tzork.theRepo.getActiveProfile();
            p.points.forEach(function (obj) {
                if (!obj._valid || !obj.show)
                    return;
                var t = Tzork.TzResolver.getTimeForPoint(obj);
                obj._t = t;
                var placed;
                resolved.some(function (v) {
                    if (Math.abs(v.t - t) < 60) {
                        v.p.push(obj);
                        placed = true;
                        return true;
                    }
                });
                if (!placed) {
                    resolved.push({ t: t, p: [obj] });
                }
            });
            resolved.forEach(function (x) {
                _this._addPointsAtTime(x.t, x.p);
            });
        };
        Clock.prototype._addPointsAtTime = function (secs, people) {
            var _this = this;
            var i;
            var first = people[0];
            var t = secs / 3600;
            var angle = Utils.hour2angle(t);
            var octant = Math.floor(angle / 45);
            var quadrant = Math.floor(octant / 2);
            var is_up = (quadrant < 2);
            var is_left = (quadrant > 0 && quadrant < 3);
            var bdrW = parseInt(window.getComputedStyle(this.disc).borderRightWidth.replace('px', ''));
            var bu = document.createElement('div');
            bu.className = 'bullet';
            bu.style.backgroundColor = first.color;
            Utils.positionAtPx(bu, angle, this.discSize / 2 - 1, this.discSize, -bdrW, 0);
            this.disc.appendChild(bu);
            var list = document.createElement('div');
            list.classList.add('people-list');
            list.classList.add(is_left ? 'left' : 'right');
            list.classList.add(is_up ? 'up' : 'down');
            list.classList.add('quad' + quadrant);
            list.classList.add('oct' + octant);
            var here = moment();
            var there = moment().tz(first._tz);
            i = Utils.mmtDayCompare(here, there);
            var clz = (i == -1) ? 'day-prev' : (i == 1) ? 'day-next' : null;
            if (clz !== null) {
                list.classList.add(clz);
                bu.classList.add(clz);
            }
            if (people.length > 1) {
                list.classList.add('multiple');
                list.classList.add('count-' + people.length);
            }
            var clr;
            for (i = 0; i < people.length; i++) {
                var peep = people[i];
                var child = this._createPointLabel(peep);
                child.title = there.format('H:mm, MMM Do') + ' — ' + peep._tz;
                list.appendChild(child);
                if (i == 0)
                    clr = child.style.color;
            }
            if (people.length > 5 && octant >= 5) {
                list.classList.add('forceGrowUp');
                octant = 6;
            }
            list.style.borderColor = clr;
            list.addEventListener('mouseover', function () {
                _this.mouse_on_list = true;
            });
            list.addEventListener('mouseout', function () {
                _this.mouse_on_list = false;
            });
            var xtra = (this.discSize / 150) * 5;
            Utils.positionAtPx(list, angle, this.discSize / 2 + xtra, this.discSize, -bdrW, octant);
            this.disc.appendChild(list);
        };
        Clock.prototype._createPointLabel = function (obj) {
            var la;
            if (obj.name.indexOf('@') === 0) {
                la = document.createElement('a');
                la.href = 'http://twitter.com/' + obj.name;
                la.target = '_blank';
            }
            else {
                la = document.createElement('span');
            }
            la.classList.add('person-label');
            la.style.color = obj.color;
            la.textContent = obj.name;
            return la;
        };
        return Clock;
    })();
    Tzork.Clock = Clock;
})(Tzork || (Tzork = {}));
var Tzork;
(function (Tzork) {
    var Menu;
    (function (Menu) {
        function init() {
            Utils.hoverMenu('#menu-btn-profiles', '#profiles-dropdown');
            document.getElementById('menu-btn-edit').addEventListener('click', function () {
                Tzork.ProfileEditor.openDialog();
            });
            buildProfilesMenu();
            var b = document.getElementById('btn-new-profile');
            b.addEventListener('click', function (e) {
                var name = prompt('New profile name?', 'New Profile');
                if (name == null) {
                    return;
                }
                var prof = Tzork.Data.createEmptyProfile();
                prof.title = name;
                Tzork.theRepo.profiles.push(prof);
                Tzork.theRepo.parse(function () {
                    Tzork.theRepo.activeProfile = Tzork.theRepo.profiles.length - 1;
                    Tzork.theClock.loadActiveProfile();
                    Tzork.theRepo.store();
                    buildProfilesMenu();
                });
            });
        }
        Menu.init = init;
        function buildProfilesMenu() {
            var pl = document.getElementById('profiles-dropdown-proflist');
            pl.innerHTML = '';
            var entries = [];
            _.each(Tzork.theRepo.profiles, function (profile, key) {
                entries.push({ k: key, n: profile.title });
            });
            entries.sort(function (a, b) {
                return a.n.localeCompare(b.n);
            });
            _.each(entries, function (e) {
                var el = document.createElement('a');
                el.textContent = e.n;
                el.dataset['index'] = e.k;
                el.classList.add('icon-profile');
                el.addEventListener('click', function () {
                    Tzork.theRepo.activeProfile = this.dataset['index'];
                    Tzork.theRepo.store();
                    Tzork.theClock.loadActiveProfile();
                });
                pl.appendChild(el);
            });
        }
        Menu.buildProfilesMenu = buildProfilesMenu;
    })(Menu = Tzork.Menu || (Tzork.Menu = {}));
})(Tzork || (Tzork = {}));
var Tzork;
(function (Tzork) {
    var ProfileEditor;
    (function (ProfileEditor) {
        var editedProfileJSON;
        var jsonSubmitBtnsEnabled;
        function init() {
            $('#menu-btn-edit').on('click', openDialog);
            $('.DialogGui .Tab').on('click', function () {
                $('.DialogGui .Pane.content').addClass('gone');
                $('.DialogGui .Tab').removeClass('active');
                var act = $(this).data('action');
                $('#pane_' + act).removeClass('gone');
                $(this).addClass('active');
            });
            $('#field_title').on('change paste keypress keyup keydown', function () {
                var _this = this;
                setTimeout(function () {
                    editedProfileJSON.title = $(_this).val();
                    updateJsonDisplay();
                }, 1);
            });
            $('#profile_json').on('change paste keypress keyup keydown', function () {
                enableJsonSubmitButtons(true);
            });
        }
        ProfileEditor.init = init;
        function enableJsonSubmitButtons(yes) {
            $('#json_change_buttons').toggleClass('disabled', !yes);
            jsonSubmitBtnsEnabled = yes;
            if (!yes) {
                $('#json_error').empty();
            }
        }
        function updateJsonDisplay() {
            $('#profile_json').val(JSON.stringify(editedProfileJSON, null, '\t'));
            enableJsonSubmitButtons(false);
        }
        function updateFieldsFromJson() {
            $('#field_title').val(editedProfileJSON.title);
        }
        function openDialog() {
            editedProfileJSON = Tzork.Data.stripProfile(Tzork.theRepo.getActiveProfile());
            updateJsonDisplay();
            updateFieldsFromJson();
            $('#json_error').empty();
            var modal = document.getElementById('profile_edit_dialog');
            modal.style.display = 'block';
            setTimeout(function () {
                modal.style.opacity = "1";
            }, 1);
        }
        ProfileEditor.openDialog = openDialog;
        function closeDialog() {
            var modal = document.getElementById('profile_edit_dialog');
            modal.style.opacity = "0";
            setTimeout(function () {
                modal.style.display = 'none';
            }, 500);
        }
        ProfileEditor.closeDialog = closeDialog;
        function reloadProfileAndCloseDialog() {
            Tzork.theRepo.parse(function () {
                Tzork.theClock.loadActiveProfile();
                Tzork.theRepo.store();
                Tzork.Menu.buildProfilesMenu();
                closeDialog();
            });
        }
        function submitProfileEdit(action) {
            switch (action) {
                case 'delete':
                    if (confirm('Delete current profile?')) {
                        Tzork.theRepo.profiles.splice(Tzork.theRepo.activeProfile, 1);
                        reloadProfileAndCloseDialog();
                    }
                    break;
                case 'close':
                    closeDialog();
                    break;
                case 'save':
                    Tzork.theRepo.profiles[Tzork.theRepo.activeProfile] = editedProfileJSON;
                    reloadProfileAndCloseDialog();
                    break;
            }
        }
        ProfileEditor.submitProfileEdit = submitProfileEdit;
        function revertJsonEdit() {
            if (!jsonSubmitBtnsEnabled)
                return;
            updateJsonDisplay();
            enableJsonSubmitButtons(false);
        }
        ProfileEditor.revertJsonEdit = revertJsonEdit;
        function submitJsonEdit() {
            if (!jsonSubmitBtnsEnabled)
                return;
            try {
                editedProfileJSON = JSON.parse($('#profile_json').val());
                enableJsonSubmitButtons(false);
            }
            catch (e) {
                var er = document.getElementById('json_error');
                if (e.message.match(/^Unexpected token [,\]}]/g)) {
                    er.textContent = 'Syntax error: trailing comma ?';
                }
                else if (e.message.match(/^Unexpected string/g)) {
                    er.textContent = 'Syntax error: missing comma ?';
                }
                else {
                    er.textContent = 'Syntax error: ' + e.message;
                }
                console.log('Error in user-entered JSON', e);
            }
        }
        ProfileEditor.submitJsonEdit = submitJsonEdit;
    })(ProfileEditor = Tzork.ProfileEditor || (Tzork.ProfileEditor = {}));
})(Tzork || (Tzork = {}));
var Tzork;
(function (Tzork) {
    Tzork.theClock;
    Tzork.theRepo;
    Tzork.theConfig;
    function init(repo, conf) {
        Tzork.theRepo = repo;
        Tzork.theConfig = conf;
        Tzork.theClock = new Tzork.Clock();
        Tzork.ProfileEditor.init();
        Tzork.Menu.init();
        Utils.fixTextareaTabKey();
    }
    Tzork.init = init;
})(Tzork || (Tzork = {}));
var Tzork;
(function (Tzork) {
    function main() {
        var repo = new Tzork.Data.LocalRepository();
        var conf = new Tzork.Data.LocalConfigProvider();
        repo.load(function () {
            Tzork.init(repo, conf);
        });
    }
    Tzork.main = main;
})(Tzork || (Tzork = {}));
//# sourceMappingURL=application.js.map